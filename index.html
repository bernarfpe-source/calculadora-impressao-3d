<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CALCULADORA DE IMPRESS√ÉO 3D</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üñ®Ô∏è</text></svg>" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #12121e; font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
  <script type="text/babel">
    const { useState, useMemo, useEffect, useCallback } = React;

    // STORAGE VIA LOCALSTORAGE
    const SK = "print3d-archive";
    async function ldA() { try { const v = localStorage.getItem(SK); return v ? JSON.parse(v) : []; } catch { return []; } }
    async function svA(items) { try { localStorage.setItem(SK, JSON.stringify(items)); } catch(e) { console.error(e); } }

    const materialData = {
      PLA: { pricePerKg: 120, density: 1.24, description: "MAIS COMUM, F√ÅCIL DE IMPRIMIR" },
      ABS: { pricePerKg: 140, density: 1.04, description: "RESISTENTE, USO INDUSTRIAL" },
      PETG: { pricePerKg: 150, density: 1.27, description: "RESISTENTE E FLEX√çVEL" },
      TPU: { pricePerKg: 200, density: 1.21, description: "FLEX√çVEL, BORRACHUDO" },
      Nylon: { pricePerKg: 280, density: 1.14, description: "ALTA RESIST√äNCIA MEC√ÇNICA" },
      Resina: { pricePerKg: 250, density: 1.10, description: "ALTA DEFINI√á√ÉO (SLA/DLP)" },
      ASA: { pricePerKg: 180, density: 1.07, description: "RESISTENTE A UV, USO EXTERNO" },
      PC: { pricePerKg: 300, density: 1.20, description: "POLICARBONATO, ALTA RESIST√äNCIA" },
    };
    const marketplacePresets = {
      nenhum: { label: "VENDA DIRETA", taxa: 0, desc: "SEM MARKETPLACE" },
      mercadolivre: { label: "MERCADO LIVRE", taxa: 13, desc: "~11-16% S/ CATEGORIA" },
      shopee: { label: "SHOPEE", taxa: 14, desc: "~12-18% + COMISS√ÉO" },
      amazon: { label: "AMAZON", taxa: 15, desc: "~8-20% S/ CATEGORIA" },
      custom: { label: "PERSONALIZADO", taxa: 0, desc: "DEFINA SUA TAXA" },
    };
    const statusOptions = [
      { id: "verificada", label: "VERIFICADA", color: "#00d4aa", icon: "‚úÖ" },
      { id: "pendente", label: "PENDENTE", color: "#ffd43b", icon: "‚è≥" },
      { id: "problema", label: "PROBLEMA", color: "#ff6b6b", icon: "‚ö†Ô∏è" },
      { id: "favorita", label: "FAVORITA", color: "#e599f7", icon: "‚≠ê" },
    ];

    function NI({ label, value, onChange, unit, step = 1, min = 0, helpText }) {
      return React.createElement("div", { style: { marginBottom: 16 } },
        React.createElement("label", { style: { display: "block", fontSize: 13, fontWeight: 600, color: "#c0c0c0", marginBottom: 6, letterSpacing: "0.5px", textTransform: "uppercase" } }, label),
        React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 } },
          React.createElement("input", { type: "number", value, onChange: (e) => onChange(parseFloat(e.target.value) || 0), step, min,
            style: { flex: 1, padding: "10px 14px", borderRadius: 10, border: "1px solid #3a3a4a", background: "#1e1e2e", color: "#f0f0f0", fontSize: 16, outline: "none" },
            onFocus: (e) => (e.target.style.borderColor = "#7c5cfc"), onBlur: (e) => (e.target.style.borderColor = "#3a3a4a") }),
          unit && React.createElement("span", { style: { color: "#888", fontSize: 14, minWidth: 30 } }, unit)
        ),
        helpText && React.createElement("span", { style: { fontSize: 11, color: "#666", marginTop: 4, display: "block" } }, helpText)
      );
    }
    function SI({ label, value, onChange, min, max, step = 1, unit = "%", helpText }) {
      return React.createElement("div", { style: { marginBottom: 16 } },
        React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6 } },
          React.createElement("label", { style: { fontSize: 13, fontWeight: 600, color: "#c0c0c0", letterSpacing: "0.5px", textTransform: "uppercase" } }, label),
          React.createElement("span", { style: { fontSize: 15, fontWeight: 700, color: "#7c5cfc" } }, value + unit)
        ),
        React.createElement("input", { type: "range", min, max, step, value, onChange: (e) => onChange(parseFloat(e.target.value)), style: { width: "100%", accentColor: "#7c5cfc" } }),
        helpText && React.createElement("span", { style: { fontSize: 11, color: "#666", marginTop: 2, display: "block" } }, helpText)
      );
    }
    function CC({ label, value, icon, color = "#7c5cfc", sub }) {
      return (<div style={{ background: "linear-gradient(135deg, #1e1e2e 0%, #2a2a3e 100%)", borderRadius: 14, padding: "14px 16px", border: `1px solid ${color}22`, flex: 1, minWidth: 120 }}>
        <div style={{ fontSize: 20, marginBottom: 4 }}>{icon}</div>
        <div style={{ fontSize: 10, color: "#888", textTransform: "uppercase", letterSpacing: "0.5px", marginBottom: 3 }}>{label}</div>
        <div style={{ fontSize: 18, fontWeight: 800, color }}>{value}</div>
        {sub && <div style={{ fontSize: 10, color: "#666", marginTop: 3 }}>{sub}</div>}
      </div>);
    }

    function App() {
      const [pg, sPg] = useState(50), [th, sTh] = useState(4), [tm, sTm] = useState(30), [mat, sMat] = useState("PLA");
      const [ci, sCi] = useState(3000), [vu, sVu] = useState(5000), [pw, sPw] = useState(250), [ckw, sCkw] = useState(0.85);
      const [inf, sInf] = useState(20), [fp, sFp] = useState(5);
      const [lix, sLix] = useState(false), [pin, sPin] = useState(false), [acab, sAcab] = useState(false), [sup, sSup] = useState(true);
      const [vhm, sVhm] = useState(30), [tsu, sTsu] = useState(15), [tpp, sTpp] = useState(20);
      const [ml, sMl] = useState(50), [qtd, sQtd] = useState(1), [cfm, sCfm] = useState(200), [hm, sHm] = useState(200);
      const [ff, sFf] = useState(15), [fpc, sFpc] = useState(true), [ce, sCe] = useState(3);
      const [rt, sRt] = useState("mei"), [ac, sAc] = useState(6);
      const [mk, sMk] = useState("nenhum"), [tmc, sTmc] = useState(15), [tfm, sTfm] = useState(0);
      const [tab, sTab] = useState("peca");
      const [arch, sArch] = useState([]), [aLoad, sALoad] = useState(true);
      const [nome, sNome] = useState(""), [notas, sNotas] = useState(""), [status, sStatus] = useState("verificada");
      const [search, sSearch] = useState(""), [filt, sFilt] = useState("todos"), [sort, sSort] = useState("data");
      const [cdel, sCdel] = useState(null), [saved, sSaved] = useState(false);

      useEffect(() => { ldA().then(i => { sArch(i); sALoad(false); }); }, []);

      const aImp = useMemo(() => ({ mei:5, simples:6, presumido:11.33, real:15, informal:0, custom:ac })[rt] ?? 5, [rt, ac]);
      const tMk = useMemo(() => mk === "nenhum" ? 0 : mk === "custom" ? tmc : marketplacePresets[mk].taxa, [mk, tmc]);

      const c = useMemo(() => {
        const m = materialData[mat], tH = th + tm / 60;
        const cMat = (pg / 1000) * m.pricePerKg, cEn = (pw / 1000) * tH * ckw, dep = (ci / vu) * tH;
        const cMdo = ((tsu + tpp) / 60) * vhm;
        let cPos = 0; if (lix) cPos += 2.5; if (pin) cPos += 8; if (acab) cPos += 5; if (sup) cPos += 1.5;
        const cFalha = (cMat + cEn) * (fp / 100), rCF = (cfm / hm) * tH, cEmb = ce, cFr = fpc ? 0 : ff;
        const cProd = cMat + cEn + dep + cMdo + cPos + cFalha + rCF + cEmb + cFr;
        const pBase = cProd * (1 + ml / 100), tTx = (tMk / 100) + (aImp / 100);
        const pFin = tTx < 1 ? pBase / (1 - tTx) : pBase * 2;
        const vImp = pFin * (aImp / 100), vMk = pFin * (tMk / 100) + tfm;
        const cTot = cProd + vImp + vMk, lucro = pFin - cTot;
        return { cMat, cEn, dep, cMdo, cPos, cFalha, rCF, cEmb, cFr, cProd, vImp, vMk, cTot, pVenda: pFin, lucro,
          cTotLote: cTot * qtd, pVendaLote: pFin * qtd, lucroLote: lucro * qtd, tH, pesoTot: pg * qtd,
          mReal: cTot > 0 ? (lucro / cTot * 100) : 0 };
      }, [pg, th, tm, mat, ci, vu, pw, ckw, inf, fp, lix, pin, acab, sup, vhm, tsu, tpp, ml, qtd, cfm, hm, ff, fpc, ce, aImp, tMk, tfm]);

      const doSave = useCallback(async () => {
        if (!nome.trim()) return;
        const np = { id: Date.now().toString(36)+Math.random().toString(36).slice(2,6), nome: nome.trim(), notas: notas.trim(), status, data: new Date().toISOString(),
          params: { pg, th, tm, mat, inf, qtd, lix, pin, acab, sup, mk, rt, ml, fpc, ff, ce },
          res: { cProd: c.cProd, cTot: c.cTot, pVenda: c.pVenda, lucro: c.lucro, mReal: c.mReal } };
        const u = [np, ...arch]; sArch(u); await svA(u); sNome(""); sNotas(""); sSaved(true); setTimeout(() => sSaved(false), 2000);
      }, [nome, notas, status, pg, th, tm, mat, inf, qtd, lix, pin, acab, sup, mk, rt, ml, fpc, ff, ce, c, arch]);

      const doDelete = useCallback(async (id) => { const u = arch.filter(p => p.id !== id); sArch(u); await svA(u); sCdel(null); }, [arch]);
      const doLoad = useCallback((p) => {
        const d = p.params; sPg(d.pg); sTh(d.th); sTm(d.tm); sMat(d.mat); sInf(d.inf); sQtd(d.qtd);
        sLix(d.lix); sPin(d.pin); sAcab(d.acab); sSup(d.sup); sMk(d.mk); sRt(d.rt); sMl(d.ml); sFpc(d.fpc); sFf(d.ff); sCe(d.ce); sTab("peca");
      }, []);
      const doStatus = useCallback(async (id, ns) => { const u = arch.map(p => p.id === id ? {...p, status: ns} : p); sArch(u); await svA(u); }, [arch]);
      const doClear = useCallback(async () => { sArch([]); await svA([]); sCdel(null); }, []);

      const fArch = useMemo(() => {
        let it = arch;
        if (filt !== "todos") it = it.filter(p => p.status === filt);
        if (search.trim()) { const q = search.toLowerCase(); it = it.filter(p => p.nome.toLowerCase().includes(q) || (p.notas||"").toLowerCase().includes(q) || p.params.mat.toLowerCase().includes(q)); }
        if (sort === "data") it = [...it].sort((a,b) => new Date(b.data)-new Date(a.data));
        else if (sort === "nome") it = [...it].sort((a,b) => a.nome.localeCompare(b.nome));
        else if (sort === "preco") it = [...it].sort((a,b) => b.res.pVenda-a.res.pVenda);
        else if (sort === "lucro") it = [...it].sort((a,b) => b.res.lucro-a.res.lucro);
        return it;
      }, [arch, filt, search, sort]);

      const aStats = useMemo(() => !arch.length ? null : ({
        total: arch.length, verif: arch.filter(p => p.status === "verificada").length,
        receita: arch.reduce((s,p) => s + p.res.pVenda*(p.params.qtd||1), 0),
        lucro: arch.reduce((s,p) => s + p.res.lucro*(p.params.qtd||1), 0),
      }), [arch]);

      const f = v => `R$ ${v.toFixed(2)}`;
      const tabs = [
        { id:"peca", label:"üéØ PE√áA" }, { id:"custos", label:"‚ö° OPERA√á√ÉO" }, { id:"mdo", label:"üë∑ M√ÉO DE OBRA" },
        { id:"acabamento", label:"‚ú® ACABAMENTO" }, { id:"venda", label:"üì¶ VENDA" }, { id:"negocio", label:"üíº NEG√ìCIO" },
        { id:"arquivo", label:`üóÇÔ∏è ARQUIVO (${arch.length})` },
      ];
      const bdi = [
        { l:"MATERIAL", v:c.cMat, cl:"#7c5cfc" }, { l:"ENERGIA", v:c.cEn, cl:"#00d4aa" }, { l:"DEPRECIA√á√ÉO", v:c.dep, cl:"#ff6b6b" },
        { l:"M√ÉO DE OBRA", v:c.cMdo, cl:"#ffa94d" }, { l:"P√ìS-PROC.", v:c.cPos, cl:"#74c0fc" }, { l:"FALHAS", v:c.cFalha, cl:"#e599f7" },
        { l:"CUSTOS FIXOS", v:c.rCF, cl:"#69db7c" }, { l:"EMBALAGEM", v:c.cEmb, cl:"#d0bfff" }, { l:"FRETE", v:c.cFr, cl:"#a9e34b" },
        { l:"IMPOSTOS", v:c.vImp, cl:"#ff8787" }, { l:"MARKETPLACE", v:c.vMk, cl:"#ffd43b" },
      ].filter(i => i.v > 0);
      const isA = tab === "arquivo";

      const Btn = ({children, active, color="#7c5cfc", onClick}) => (
        <button onClick={onClick} style={{ padding:"8px 14px", borderRadius:8, cursor:"pointer", fontSize:12, fontWeight:600, border: active ? `2px solid ${color}` : "1px solid #3a3a4a", background: active ? `${color}18` : "#1e1e2e", color: active ? color : "#888" }}>{children}</button>
      );

      return (
        <div style={{ minHeight:"100vh", background:"#12121e", color:"#f0f0f0", fontFamily:"'Inter',-apple-system,sans-serif" }}>
          <div style={{ maxWidth:920, margin:"0 auto", padding:"24px 16px" }}>
            <div style={{ textAlign:"center", marginBottom:28 }}>
              <div style={{ fontSize:38, marginBottom:4 }}>üñ®Ô∏è</div>
              <h1 style={{ fontSize:26, fontWeight:800, margin:0, background:"linear-gradient(135deg,#7c5cfc,#00d4aa)", WebkitBackgroundClip:"text", WebkitTextFillColor:"transparent" }}>CALCULADORA DE IMPRESS√ÉO 3D</h1>
              <p style={{ color:"#666", fontSize:14, marginTop:6 }}>CALCULE TODOS OS CUSTOS E PRECIFIQUE SUAS PE√áAS</p>
            </div>

            {!isA && <div style={{ display:"flex", gap:10, flexWrap:"wrap", marginBottom:24 }}>
              <CC icon="üè≠" label="CUSTO PRODU√á√ÉO" value={f(c.cProd)} color="#ff6b6b" sub="SEM IMPOSTOS/TAXAS" />
              <CC icon="üí∞" label="CUSTO TOTAL" value={f(c.cTot)} color="#ffa94d" sub={`${qtd}X = ${f(c.cTotLote)}`} />
              <CC icon="üè∑Ô∏è" label="PRE√áO VENDA" value={f(c.pVenda)} color="#00d4aa" sub={`MARGEM: ${c.mReal.toFixed(1)}%`} />
              <CC icon="üìà" label="LUCRO L√çQUIDO" value={f(c.lucro)} color="#7c5cfc" sub={`TOTAL: ${f(c.lucroLote)}`} />
            </div>}
            {isA && aStats && <div style={{ display:"flex", gap:10, flexWrap:"wrap", marginBottom:24 }}>
              <CC icon="üóÇÔ∏è" label="TOTAL PE√áAS" value={aStats.total} color="#7c5cfc" sub={`${aStats.verif} VERIFICADAS`} />
              <CC icon="üí∞" label="RECEITA POTENCIAL" value={f(aStats.receita)} color="#00d4aa" sub="TODAS AS PE√áAS" />
              <CC icon="üìà" label="LUCRO POTENCIAL" value={f(aStats.lucro)} color="#ffa94d" sub="TODAS AS PE√áAS" />
            </div>}

            <div style={{ display:"flex", gap:4, marginBottom:20, overflowX:"auto", paddingBottom:4 }}>
              {tabs.map(t => <button key={t.id} onClick={() => sTab(t.id)} style={{
                padding:"10px 16px", borderRadius:10, border:"none", fontSize:13, fontWeight:600, cursor:"pointer", whiteSpace:"nowrap",
                background: tab===t.id ? (t.id==="arquivo"?"linear-gradient(135deg,#00d4aa,#0a9d80)":"linear-gradient(135deg,#7c5cfc,#5a3fd4)") : "#1e1e2e",
                color: tab===t.id ? "#fff" : "#888",
              }}>{t.label}</button>)}
            </div>

            {isA ? (
              <div style={{ display:"flex", gap:20, flexWrap:"wrap" }}>
                <div style={{ flex:1, minWidth:300 }}>
                  <div style={{ background:"#1a1a2e", borderRadius:16, padding:24, border:"1px solid #2a2a3e", marginBottom:20 }}>
                    <h3 style={{ margin:"0 0 18px", fontSize:16, color:"#00d4aa" }}>üíæ SALVAR PE√áA ATUAL</h3>
                    <div style={{ marginBottom:16 }}>
                      <label style={{ display:"block", fontSize:13, fontWeight:600, color:"#c0c0c0", marginBottom:6, textTransform:"uppercase" }}>NOME DA PE√áA *</label>
                      <input type="text" value={nome} onChange={e => sNome(e.target.value)} placeholder="EX: SUPORTE CELULAR V2"
                        style={{ width:"100%", padding:"10px 14px", borderRadius:10, border:"1px solid #3a3a4a", background:"#1e1e2e", color:"#f0f0f0", fontSize:15, outline:"none", boxSizing:"border-box" }} />
                    </div>
                    <div style={{ marginBottom:16 }}>
                      <label style={{ display:"block", fontSize:13, fontWeight:600, color:"#c0c0c0", marginBottom:8, textTransform:"uppercase" }}>STATUS</label>
                      <div style={{ display:"flex", gap:6, flexWrap:"wrap" }}>
                        {statusOptions.map(s => <Btn key={s.id} active={status===s.id} color={s.color} onClick={() => sStatus(s.id)}>{s.icon} {s.label}</Btn>)}
                      </div>
                    </div>
                    <div style={{ marginBottom:16 }}>
                      <label style={{ display:"block", fontSize:13, fontWeight:600, color:"#c0c0c0", marginBottom:6, textTransform:"uppercase" }}>OBSERVA√á√ïES</label>
                      <textarea value={notas} onChange={e => sNotas(e.target.value)} placeholder="ANOTA√á√ïES, CONFIGS DO SLICER..." rows={3}
                        style={{ width:"100%", padding:"10px 14px", borderRadius:10, border:"1px solid #3a3a4a", background:"#1e1e2e", color:"#f0f0f0", fontSize:14, outline:"none", resize:"vertical", boxSizing:"border-box", fontFamily:"inherit" }} />
                    </div>
                    <div style={{ padding:14, background:"#12121e", borderRadius:10, border:"1px solid #2a2a3e", marginBottom:16 }}>
                      <div style={{ fontSize:12, color:"#888", marginBottom:8 }}>RESUMO</div>
                      <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:6, fontSize:12 }}>
                        {[["MATERIAL", mat, "#7c5cfc"], ["PESO", pg+"G", "#f0f0f0"], ["TEMPO", `${th}H${tm}M`, "#f0f0f0"], ["QTD", qtd+"X", "#f0f0f0"],
                          ["CUSTO", f(c.cTot), "#ff6b6b"], ["VENDA", f(c.pVenda), "#00d4aa"], ["LUCRO", f(c.lucro), "#7c5cfc"], ["MARGEM", c.mReal.toFixed(1)+"%", "#ffa94d"]
                        ].map(([k,v,cl]) => <div key={k}><span style={{ color:"#666" }}>{k}: </span><span style={{ color:cl, fontWeight:600 }}>{v}</span></div>)}
                      </div>
                    </div>
                    <button onClick={doSave} disabled={!nome.trim()} style={{
                      width:"100%", padding:14, borderRadius:12, border:"none", fontSize:15, fontWeight:700,
                      cursor: nome.trim() ? "pointer" : "not-allowed",
                      background: nome.trim() ? (saved ? "#00d4aa" : "linear-gradient(135deg,#00d4aa,#0a9d80)") : "#2a2a3e",
                      color: nome.trim() ? "#fff" : "#555",
                    }}>{saved ? "‚úÖ SALVA!" : "üíæ SALVAR NO ARQUIVO"}</button>
                  </div>
                  {arch.length > 0 && <div style={{ padding:16, background:"#1a1a2e", borderRadius:12, border:"1px solid #ff6b6b33" }}>
                    <div style={{ fontSize:12, color:"#ff6b6b", marginBottom:8, fontWeight:600 }}>‚ö†Ô∏è ZONA DE PERIGO</div>
                    {cdel === "all" ? <div style={{ display:"flex", gap:8 }}>
                      <button onClick={doClear} style={{ flex:1, padding:10, borderRadius:8, border:"none", background:"#ff6b6b", color:"#fff", fontWeight:600, cursor:"pointer", fontSize:13 }}>CONFIRMAR APAGAR TUDO</button>
                      <button onClick={() => sCdel(null)} style={{ flex:1, padding:10, borderRadius:8, border:"1px solid #3a3a4a", background:"#1e1e2e", color:"#888", cursor:"pointer", fontSize:13 }}>CANCELAR</button>
                    </div> : <button onClick={() => sCdel("all")} style={{ width:"100%", padding:10, borderRadius:8, border:"1px solid #ff6b6b44", background:"transparent", color:"#ff6b6b", fontWeight:600, cursor:"pointer", fontSize:13 }}>üóëÔ∏è LIMPAR ARQUIVO ({arch.length} PE√áAS)</button>}
                  </div>}
                </div>

                <div style={{ flex:1, minWidth:300 }}>
                  <div style={{ background:"#1a1a2e", borderRadius:16, padding:24, border:"1px solid #2a2a3e" }}>
                    <h3 style={{ margin:"0 0 16px", fontSize:16, color:"#f0f0f0" }}>üóÇÔ∏è PE√áAS ARQUIVADAS</h3>
                    <input type="text" value={search} onChange={e => sSearch(e.target.value)} placeholder="üîç BUSCAR POR NOME, NOTA OU MATERIAL..."
                      style={{ width:"100%", padding:"10px 14px", borderRadius:10, border:"1px solid #3a3a4a", background:"#12121e", color:"#f0f0f0", fontSize:14, outline:"none", boxSizing:"border-box", marginBottom:10 }} />
                    <div style={{ display:"flex", gap:4, flexWrap:"wrap", marginBottom:8 }}>
                      <Btn active={filt==="todos"} onClick={() => sFilt("todos")}>TODOS</Btn>
                      {statusOptions.map(s => <Btn key={s.id} active={filt===s.id} color={s.color} onClick={() => sFilt(s.id)}>{s.icon} {s.label}</Btn>)}
                    </div>
                    <div style={{ display:"flex", gap:4, alignItems:"center", marginBottom:16 }}>
                      <span style={{ fontSize:11, color:"#555", marginRight:4 }}>ORDENAR:</span>
                      {[["data","RECENTE"],["nome","A-Z"],["preco","PRE√áO"],["lucro","LUCRO"]].map(([id,lb]) => (
                        <button key={id} onClick={() => sSort(id)} style={{ padding:"4px 10px", borderRadius:6, fontSize:11, fontWeight:600, cursor:"pointer", border: sort===id ? "1px solid #7c5cfc" : "1px solid #2a2a3e", background: sort===id ? "#7c5cfc18" : "transparent", color: sort===id ? "#7c5cfc" : "#555" }}>{lb}</button>
                      ))}
                    </div>
                    {aLoad ? <div style={{ textAlign:"center", padding:40, color:"#555" }}>CARREGANDO...</div>
                    : fArch.length === 0 ? <div style={{ textAlign:"center", padding:40 }}>
                        <div style={{ fontSize:40, marginBottom:12 }}>üì≠</div>
                        <div style={{ color:"#555", fontSize:14 }}>{arch.length === 0 ? "NENHUMA PE√áA SALVA" : "SEM RESULTADOS"}</div>
                      </div>
                    : <div style={{ display:"flex", flexDirection:"column", gap:10, maxHeight:520, overflowY:"auto" }}>
                      {fArch.map(p => {
                        const st = statusOptions.find(s => s.id === p.status) || statusOptions[0];
                        const dt = new Date(p.data).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"2-digit"});
                        return (<div key={p.id} style={{ padding:16, background:"#12121e", borderRadius:12, border:`1px solid ${st.color}33` }}>
                          <div style={{ marginBottom:10 }}>
                            <div style={{ fontSize:15, fontWeight:700, color:"#f0f0f0", marginBottom:4 }}>{p.nome}</div>
                            <div style={{ display:"flex", gap:8, alignItems:"center", flexWrap:"wrap" }}>
                              <span style={{ fontSize:11, color:st.color, fontWeight:600, background:`${st.color}18`, padding:"2px 8px", borderRadius:4 }}>{st.icon} {st.label}</span>
                              <span style={{ fontSize:11, color:"#555" }}>{dt}</span>
                              <span style={{ fontSize:11, color:"#7c5cfc", fontWeight:600 }}>{p.params.mat}</span>
                              <span style={{ fontSize:11, color:"#888" }}>{p.params.pg}G</span>
                            </div>
                          </div>
                          {p.notas && <div style={{ fontSize:12, color:"#777", marginBottom:10, fontStyle:"italic" }}>"{p.notas}"</div>}
                          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr 1fr", gap:8, marginBottom:12 }}>
                            {[["CUSTO",p.res.cTot,"#ff6b6b"],["VENDA",p.res.pVenda,"#00d4aa"],["LUCRO",p.res.lucro,"#7c5cfc"]].map(([lb,v,cl]) => (
                              <div key={lb} style={{ textAlign:"center", padding:8, background:"#1a1a2e", borderRadius:8 }}>
                                <div style={{ fontSize:10, color:"#666" }}>{lb}</div>
                                <div style={{ fontSize:14, fontWeight:700, color:cl }}>{f(v)}</div>
                              </div>
                            ))}
                          </div>
                          <div style={{ display:"flex", gap:4, marginBottom:10, flexWrap:"wrap" }}>
                            {statusOptions.map(s => <button key={s.id} onClick={() => doStatus(p.id, s.id)} style={{ padding:"4px 8px", borderRadius:4, fontSize:10, cursor:"pointer", fontWeight:600, border: p.status===s.id ? `1px solid ${s.color}` : "1px solid #2a2a3e", background: p.status===s.id ? `${s.color}22` : "transparent", color: p.status===s.id ? s.color : "#444" }}>{s.icon}</button>)}
                          </div>
                          <div style={{ display:"flex", gap:8 }}>
                            <button onClick={() => doLoad(p)} style={{ flex:1, padding:8, borderRadius:8, border:"1px solid #7c5cfc44", background:"#7c5cfc12", color:"#7c5cfc", fontSize:12, fontWeight:600, cursor:"pointer" }}>üìã CARREGAR</button>
                            {cdel === p.id ? <div style={{ display:"flex", gap:4 }}>
                              <button onClick={() => doDelete(p.id)} style={{ padding:"8px 12px", borderRadius:8, border:"none", background:"#ff6b6b", color:"#fff", fontSize:12, fontWeight:600, cursor:"pointer" }}>SIM</button>
                              <button onClick={() => sCdel(null)} style={{ padding:"8px 12px", borderRadius:8, border:"1px solid #3a3a4a", background:"#1e1e2e", color:"#888", fontSize:12, cursor:"pointer" }}>N√ÉO</button>
                            </div> : <button onClick={() => sCdel(p.id)} style={{ padding:"8px 12px", borderRadius:8, border:"1px solid #ff6b6b33", background:"transparent", color:"#ff6b6b88", fontSize:12, cursor:"pointer" }}>üóëÔ∏è</button>}
                          </div>
                        </div>);
                      })}
                    </div>}
                  </div>
                </div>
              </div>
            ) : (
              <div style={{ display:"flex", gap:20, flexWrap:"wrap" }}>
                <div style={{ flex:1, minWidth:300 }}>
                  <div style={{ background:"#1a1a2e", borderRadius:16, padding:24, border:"1px solid #2a2a3e" }}>
                    {tab === "peca" && <>
                      <h3 style={{ margin:"0 0 18px", fontSize:16 }}>üìê DADOS DA PE√áA</h3>
                      <div style={{ marginBottom:16 }}>
                        <label style={{ display:"block", fontSize:13, fontWeight:600, color:"#c0c0c0", marginBottom:6, textTransform:"uppercase" }}>MATERIAL</label>
                        <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:8 }}>
                          {Object.entries(materialData).map(([k,m]) => (
                            <button key={k} onClick={() => sMat(k)} style={{ padding:"10px 12px", borderRadius:10, textAlign:"left", cursor:"pointer",
                              border: mat===k ? "2px solid #7c5cfc" : "1px solid #3a3a4a", background: mat===k ? "#7c5cfc18" : "#1e1e2e", color: mat===k ? "#7c5cfc" : "#aaa", fontSize:13, fontWeight:600 }}>
                              <div>{k}</div><div style={{ fontSize:10, color:"#666", marginTop:2 }}>{m.description}</div><div style={{ fontSize:10, color:"#7c5cfc", marginTop:2 }}>R$ {m.pricePerKg}/KG</div>
                            </button>
                          ))}
                        </div>
                      </div>
                      <NI label="PESO DA PE√áA" value={pg} onChange={sPg} unit="G" helpText="PESO ESTIMADO PELO SLICER" />
                      <div style={{ display:"flex", gap:12 }}><div style={{ flex:1 }}><NI label="HORAS" value={th} onChange={sTh} unit="H" /></div><div style={{ flex:1 }}><NI label="MIN" value={tm} onChange={sTm} unit="MIN" /></div></div>
                      <SI label="INFILL" value={inf} onChange={sInf} min={5} max={100} step={5} helpText="PREENCHIMENTO" />
                      <NI label="QUANTIDADE" value={qtd} onChange={sQtd} unit="UN" min={1} />
                    </>}
                    {tab === "custos" && <>
                      <h3 style={{ margin:"0 0 18px", fontSize:16 }}>‚ö° CUSTOS OPERACIONAIS</h3>
                      <NI label="CUSTO DA IMPRESSORA" value={ci} onChange={sCi} unit="R$" step={100} helpText="VALOR DE COMPRA" />
                      <NI label="VIDA √öTIL" value={vu} onChange={sVu} unit="H" step={100} />
                      <NI label="POT√äNCIA" value={pw} onChange={sPw} unit="W" step={10} />
                      <NI label="CUSTO KWH" value={ckw} onChange={sCkw} unit="R$/KWH" step={0.01} helpText="VEJA NA CONTA DE LUZ" />
                      <SI label="TAXA DE FALHA" value={fp} onChange={sFp} min={0} max={30} />
                    </>}
                    {tab === "mdo" && <>
                      <h3 style={{ margin:"0 0 18px", fontSize:16 }}>üë∑ M√ÉO DE OBRA</h3>
                      <NI label="VALOR HORA" value={vhm} onChange={sVhm} unit="R$/H" step={5} />
                      <NI label="SETUP" value={tsu} onChange={sTsu} unit="MIN" step={5} helpText="PREPARAR, FATIAR, NIVELAR" />
                      <NI label="P√ìS-PROCESSAMENTO" value={tpp} onChange={sTpp} unit="MIN" step={5} />
                      <div style={{ marginTop:16, padding:14, background:"#12121e", borderRadius:10, border:"1px solid #2a2a3e" }}>
                        <div style={{ fontSize:12, color:"#888" }}>TOTAL M√ÉO DE OBRA</div>
                        <div style={{ fontSize:20, fontWeight:700, color:"#ffa94d" }}>{tsu+tpp} MIN</div>
                      </div>
                    </>}
                    {tab === "acabamento" && <>
                      <h3 style={{ margin:"0 0 18px", fontSize:16 }}>‚ú® P√ìS-PROCESSAMENTO</h3>
                      {[["REMO√á√ÉO SUPORTE","CORTAR SUPORTES",1.5,sup,sSup],["LIXAMENTO","LIXAR SUPERF√çCIES",2.5,lix,sLix],["PINTURA","PRIMER+TINTA+VERNIZ",8,pin,sPin],["ACABAMENTO ESPECIAL","EP√ìXI, ACETONA",5,acab,sAcab]].map(([lb,desc,pr,st,set]) => (
                        <button key={lb} onClick={() => set(!st)} style={{ display:"flex", alignItems:"center", justifyContent:"space-between", width:"100%", padding:"14px 16px", marginBottom:8, borderRadius:10, cursor:"pointer",
                          border: st ? "2px solid #7c5cfc" : "1px solid #3a3a4a", background: st ? "#7c5cfc12" : "#1e1e2e", color:"#f0f0f0" }}>
                          <div style={{ textAlign:"left" }}><div style={{ fontSize:14, fontWeight:600 }}>{lb}</div><div style={{ fontSize:11, color:"#666", marginTop:2 }}>{desc}</div></div>
                          <div style={{ textAlign:"right" }}><div style={{ fontSize:14, fontWeight:700, color: st ? "#7c5cfc" : "#666" }}>+R$ {pr.toFixed(2)}</div>
                            <div style={{ width:20, height:20, borderRadius:6, background: st?"#7c5cfc":"transparent", border: st?"none":"2px solid #3a3a4a", margin:"4px 0 0 auto", display:"flex", alignItems:"center", justifyContent:"center", fontSize:12, color:"#fff" }}>{st?"‚úì":""}</div>
                          </div>
                        </button>
                      ))}
                    </>}
                    {tab === "venda" && <>
                      <h3 style={{ margin:"0 0 18px", fontSize:16 }}>üì¶ FRETE, IMPOSTOS E MARKETPLACE</h3>
                      <div style={{ padding:16, background:"#12121e", borderRadius:12, border:"1px solid #2a2a3e", marginBottom:16 }}>
                        <div style={{ fontSize:13, fontWeight:700, color:"#a9e34b", marginBottom:12, textTransform:"uppercase" }}>üöö FRETE E EMBALAGEM</div>
                        <NI label="EMBALAGEM" value={ce} onChange={sCe} unit="R$" step={0.5} helpText="CAIXA, BOLHA, FITA" />
                        <NI label="FRETE" value={ff} onChange={sFf} unit="R$" helpText="CORREIOS/TRANSPORTADORA" />
                        <div style={{ display:"flex", gap:8 }}>
                          {[[true,"CLIENTE PAGA"],[false,"FRETE INCLUSO"]].map(([v,lb]) => (
                            <button key={String(v)} onClick={() => sFpc(v)} style={{ flex:1, padding:"10px 12px", borderRadius:10, cursor:"pointer", textAlign:"center",
                              border: fpc===v ? "2px solid #a9e34b" : "1px solid #3a3a4a", background: fpc===v ? "#a9e34b15" : "#1e1e2e", color: fpc===v ? "#a9e34b" : "#888", fontSize:13, fontWeight:600 }}>{lb}</button>
                          ))}
                        </div>
                      </div>
                      <div style={{ padding:16, background:"#12121e", borderRadius:12, border:"1px solid #2a2a3e", marginBottom:16 }}>
                        <div style={{ fontSize:13, fontWeight:700, color:"#ff8787", marginBottom:12, textTransform:"uppercase" }}>üèõÔ∏è IMPOSTOS</div>
                        <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:8, marginBottom:12 }}>
                          {[["informal","INFORMAL","SEM CNPJ","0%"],["mei","MEI","MICROEMPREENDEDOR","~5%"],["simples","SIMPLES","ANEXO III/V","~6%"],["presumido","PRESUMIDO","ISS+PIS+COFINS","~11%"],["real","LUCRO REAL","EMPRESAS MAIORES","~15%"],["custom","PERSONALIZADO","SUA AL√çQUOTA","‚Äî"]].map(([id,lb,desc,rate]) => (
                            <button key={id} onClick={() => sRt(id)} style={{ padding:"10px 12px", borderRadius:10, cursor:"pointer", textAlign:"left",
                              border: rt===id ? "2px solid #ff8787" : "1px solid #3a3a4a", background: rt===id ? "#ff878715" : "#1e1e2e", color: rt===id ? "#ff8787" : "#aaa" }}>
                              <div style={{ fontSize:13, fontWeight:600 }}>{lb}</div><div style={{ fontSize:10, color:"#666", marginTop:2 }}>{desc}</div><div style={{ fontSize:11, color:"#ff8787", marginTop:2, fontWeight:700 }}>{rate}</div>
                            </button>
                          ))}
                        </div>
                        {rt === "custom" && <SI label="AL√çQUOTA" value={ac} onChange={sAc} min={0} max={30} step={0.5} />}
                        <div style={{ padding:10, background:"#1a1a2e", borderRadius:8 }}><div style={{ fontSize:12, color:"#888" }}>AL√çQUOTA EFETIVA</div><div style={{ fontSize:20, fontWeight:800, color:"#ff8787" }}>{aImp}%</div></div>
                      </div>
                      <div style={{ padding:16, background:"#12121e", borderRadius:12, border:"1px solid #2a2a3e" }}>
                        <div style={{ fontSize:13, fontWeight:700, color:"#ffd43b", marginBottom:12, textTransform:"uppercase" }}>üõí MARKETPLACE</div>
                        <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:8, marginBottom:12 }}>
                          {Object.entries(marketplacePresets).map(([k,mp]) => (
                            <button key={k} onClick={() => sMk(k)} style={{ padding:"10px 12px", borderRadius:10, cursor:"pointer", textAlign:"left",
                              border: mk===k ? "2px solid #ffd43b" : "1px solid #3a3a4a", background: mk===k ? "#ffd43b15" : "#1e1e2e", color: mk===k ? "#ffd43b" : "#aaa" }}>
                              <div style={{ fontSize:13, fontWeight:600 }}>{mp.label}</div><div style={{ fontSize:10, color:"#666", marginTop:2 }}>{mp.desc}</div>
                              {k!=="nenhum" && k!=="custom" && <div style={{ fontSize:11, color:"#ffd43b", marginTop:2, fontWeight:700 }}>~{mp.taxa}%</div>}
                            </button>
                          ))}
                        </div>
                        {mk === "custom" && <SI label="TAXA MARKETPLACE" value={tmc} onChange={sTmc} min={0} max={40} step={0.5} />}
                        {mk !== "nenhum" && <NI label="TAXA FIXA/VENDA" value={tfm} onChange={sTfm} unit="R$" step={0.5} />}
                        <div style={{ padding:10, background:"#1a1a2e", borderRadius:8 }}><div style={{ fontSize:12, color:"#888" }}>TAXA</div><div style={{ fontSize:20, fontWeight:800, color:"#ffd43b" }}>{tMk}%{tfm>0?` + R$${tfm.toFixed(2)}`:""}</div></div>
                      </div>
                    </>}
                    {tab === "negocio" && <>
                      <h3 style={{ margin:"0 0 18px", fontSize:16 }}>üíº NEG√ìCIO</h3>
                      <SI label="MARGEM DE LUCRO" value={ml} onChange={sMl} min={0} max={200} step={5} helpText="SOBRE CUSTO DE PRODU√á√ÉO" />
                      <NI label="CUSTOS FIXOS/M√äS" value={cfm} onChange={sCfm} unit="R$" step={10} helpText="ALUGUEL, INTERNET, SOFTWARE" />
                      <NI label="HORAS PRODUTIVAS/M√äS" value={hm} onChange={sHm} unit="H" step={10} />
                      <div style={{ marginTop:16, padding:14, background:"#12121e", borderRadius:10, border:"1px solid #2a2a3e" }}>
                        <div style={{ fontSize:12, color:"#888" }}>CUSTO FIXO/HORA</div>
                        <div style={{ fontSize:20, fontWeight:700, color:"#69db7c" }}>R$ {(cfm/hm).toFixed(2)}/H</div>
                      </div>
                      <div style={{ marginTop:16, padding:14, background:"#12121e", borderRadius:10, border:"1px solid #ff878744" }}>
                        <div style={{ fontSize:12, color:"#888", marginBottom:8 }}>DEDU√á√ïES SOBRE VENDA</div>
                        <div style={{ display:"flex", justifyContent:"space-between", marginBottom:4 }}><span style={{ fontSize:13, color:"#ccc" }}>IMPOSTOS ({aImp}%)</span><span style={{ fontSize:13, fontWeight:700, color:"#ff8787" }}>{f(c.vImp)}</span></div>
                        <div style={{ display:"flex", justifyContent:"space-between", marginBottom:4 }}><span style={{ fontSize:13, color:"#ccc" }}>MARKETPLACE ({tMk}%)</span><span style={{ fontSize:13, fontWeight:700, color:"#ffd43b" }}>{f(c.vMk)}</span></div>
                        <div style={{ height:1, background:"#3a3a4a", margin:"8px 0" }} />
                        <div style={{ display:"flex", justifyContent:"space-between" }}><span style={{ fontSize:13, fontWeight:700 }}>TOTAL</span><span style={{ fontSize:15, fontWeight:800, color:"#ff6b6b" }}>{f(c.vImp+c.vMk)}</span></div>
                      </div>
                    </>}
                  </div>
                </div>

                <div style={{ flex:1, minWidth:300 }}>
                  <div style={{ background:"#1a1a2e", borderRadius:16, padding:24, border:"1px solid #2a2a3e" }}>
                    <h3 style={{ margin:"0 0 18px", fontSize:16 }}>üìä DECOMPOSI√á√ÉO DO CUSTO</h3>
                    <div style={{ display:"flex", height:12, borderRadius:6, overflow:"hidden", marginBottom:20 }}>
                      {bdi.map(i => { const p = c.cTot > 0 ? (i.v/c.cTot)*100 : 0; return p > 0.5 ? <div key={i.l} style={{ width:`${p}%`, background:i.cl, transition:"width 0.3s" }} /> : null; })}
                    </div>
                    {bdi.map(i => { const p = c.cTot > 0 ? (i.v/c.cTot)*100 : 0; return (
                      <div key={i.l} style={{ display:"flex", justifyContent:"space-between", alignItems:"center", padding:"10px 0", borderBottom:"1px solid #2a2a3e" }}>
                        <div style={{ display:"flex", alignItems:"center", gap:10 }}><div style={{ width:10, height:10, borderRadius:3, background:i.cl }} /><span style={{ fontSize:14, color:"#ccc" }}>{i.l}</span></div>
                        <div><span style={{ fontSize:14, fontWeight:700 }}>{f(i.v)}</span><span style={{ fontSize:11, color:"#666", marginLeft:8 }}>{p.toFixed(1)}%</span></div>
                      </div>); })}
                    <div style={{ display:"flex", justifyContent:"space-between", padding:"10px 0", borderBottom:"1px solid #3a3a4a" }}>
                      <span style={{ fontSize:14, fontWeight:700, color:"#aaa" }}>CUSTO PRODU√á√ÉO</span><span style={{ fontSize:16, fontWeight:700, color:"#ffa94d" }}>{f(c.cProd)}</span>
                    </div>
                    <div style={{ display:"flex", justifyContent:"space-between", padding:"14px 0", marginTop:4, borderTop:"2px solid #7c5cfc44" }}>
                      <span style={{ fontSize:16, fontWeight:800 }}>CUSTO TOTAL</span><span style={{ fontSize:20, fontWeight:800, color:"#7c5cfc" }}>{f(c.cTot)}</span>
                    </div>
                    <div style={{ marginTop:16, padding:16, background:"linear-gradient(135deg,#7c5cfc15,#00d4aa15)", borderRadius:12, border:"1px solid #7c5cfc33" }}>
                      <div style={{ display:"flex", justifyContent:"space-between", marginBottom:8 }}><span style={{ color:"#aaa", fontSize:13 }}>PRE√áO VENDA</span><span style={{ color:"#00d4aa", fontSize:18, fontWeight:800 }}>{f(c.pVenda)}</span></div>
                      <div style={{ display:"flex", justifyContent:"space-between", marginBottom:8 }}><span style={{ color:"#aaa", fontSize:13 }}>LUCRO L√çQUIDO</span><span style={{ color:"#7c5cfc", fontSize:16, fontWeight:700 }}>{f(c.lucro)}</span></div>
                      <div style={{ display:"flex", justifyContent:"space-between", marginBottom:8 }}><span style={{ color:"#aaa", fontSize:13 }}>MARGEM REAL</span><span style={{ color: c.mReal>=ml?"#00d4aa":"#ff6b6b", fontSize:14, fontWeight:700 }}>{c.mReal.toFixed(1)}%</span></div>
                      {fpc && ff > 0 && <div style={{ display:"flex", justifyContent:"space-between", marginBottom:8, opacity:0.7 }}><span style={{ color:"#aaa", fontSize:12 }}>+ FRETE (CLIENTE)</span><span style={{ color:"#a9e34b", fontSize:13, fontWeight:600 }}>+ {f(ff)}</span></div>}
                      {qtd > 1 && <>
                        <div style={{ height:1, background:"#3a3a4a", margin:"10px 0" }} />
                        <div style={{ display:"flex", justifyContent:"space-between", marginBottom:6 }}><span style={{ color:"#aaa", fontSize:13 }}>TOTAL ({qtd}X)</span><span style={{ color:"#00d4aa", fontSize:16, fontWeight:700 }}>{f(c.pVendaLote)}</span></div>
                        <div style={{ display:"flex", justifyContent:"space-between" }}><span style={{ color:"#aaa", fontSize:13 }}>LUCRO TOTAL</span><span style={{ color:"#7c5cfc", fontSize:16, fontWeight:700 }}>{f(c.lucroLote)}</span></div>
                      </>}
                    </div>
                    <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:10, marginTop:16 }}>
                      {[["CUSTO/G", pg>0?`R$ ${(c.cTot/pg).toFixed(3)}`:"‚Äî","#ffa94d"], ["CUSTO/H", c.tH>0?`R$ ${(c.cTot/c.tH).toFixed(2)}`:"‚Äî","#ffa94d"], ["DEPREC./H",`R$ ${(ci/vu).toFixed(2)}`,"#74c0fc"], ["TAXAS",`${(aImp+tMk).toFixed(1)}%`,"#ff8787"]].map(([lb,v,cl]) => (
                        <div key={lb} style={{ padding:12, background:"#12121e", borderRadius:10, textAlign:"center" }}>
                          <div style={{ fontSize:11, color:"#666" }}>{lb}</div><div style={{ fontSize:16, fontWeight:700, color:cl }}>{v}</div>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            )}
            <div style={{ textAlign:"center", marginTop:24, padding:16, color:"#444", fontSize:12 }}>VALORES ESTIMADOS. CONSULTE UM CONTADOR PARA AL√çQUOTAS EXATAS.</div>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
  </script>
</body>
</html>
