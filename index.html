<!DOCTYPE html>
<html lang="PT-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CALCULADORA DE IMPRESS√ÉO 3D - CB¬≤K</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üñ®Ô∏è</text></svg>" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #12121e; font-family: 'Inter', -apple-system, sans-serif; color: #f0f0f0; }
    input[type="range"] { accent-color: #7c5cfc; width: 100%; cursor: pointer; }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-thumb { background: #3a3a4a; border-radius: 10px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useMemo, useEffect, useCallback } = React;

    const SK = "PRINT3D-ARCHIVE";
    const ldA = () => { try { const v = localStorage.getItem(SK); return v ? JSON.parse(v) : []; } catch { return []; } };
    const svA = (items) => { try { localStorage.setItem(SK, JSON.stringify(items)); } catch(e) { console.error(e); } };

    const materialData = {
      PLA: { pricePerKg: 120, density: 1.24, description: "MAIS COMUM, F√ÅCIL" },
      ABS: { pricePerKg: 140, density: 1.04, description: "RESISTENTE, INDUSTRIAL" },
      PETG: { pricePerKg: 150, density: 1.27, description: "RESISTENTE E FLEX√çVEL" },
      TPU: { pricePerKg: 200, density: 1.21, description: "BORRACHUDO" },
      NYLON: { pricePerKg: 280, density: 1.14, description: "ALTA RESIST√äNCIA" },
      RESINA: { pricePerKg: 250, density: 1.10, description: "ALTA DEFINI√á√ÉO" },
      ASA: { pricePerKg: 180, density: 1.07, description: "RESISTENTE A UV" },
      PC: { pricePerKg: 300, density: 1.20, description: "ALTA RESIST√äNCIA" },
    };

    const marketplacePresets = {
      nenhum: { label: "VENDA DIRETA", taxa: 0, desc: "SEM MARKETPLACE" },
      mercadolivre: { label: "MERCADO LIVRE", taxa: 13, desc: "~11-16% S/ CATEGORIA" },
      shopee: { label: "SHOPEE", taxa: 14, desc: "~12-18% + COMISS√ÉO" },
      amazon: { label: "AMAZON", taxa: 15, desc: "~8-20% S/ CATEGORIA" },
      custom: { label: "PERSONALIZADO", taxa: 0, desc: "DEFINA SUA TAXA" },
    };

    const statusOptions = [
      { id: "verificada", label: "VERIFICADA", color: "#00d4aa", icon: "‚úÖ" },
      { id: "pendente", label: "PENDENTE", color: "#ffd43b", icon: "‚è≥" },
      { id: "problema", label: "PROBLEMA", color: "#ff6b6b", icon: "‚ö†Ô∏è" },
      { id: "favorita", label: "FAVORITA", color: "#e599f7", icon: "‚≠ê" },
    ];

    function NI({ label, value, onChange, unit, step = 1, min = 0, helpText }) {
      return (
        <div style={{ marginBottom: 16 }}>
          <label style={{ display: "block", fontSize: 11, fontWeight: 700, color: "#c0c0c0", marginBottom: 6, textTransform: "uppercase" }}>{label}</label>
          <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
            <input type="number" value={value} onChange={(e) => onChange(parseFloat(e.target.value) || 0)} step={step} min={min}
              style={{ flex: 1, padding: "10px 14px", borderRadius: 10, border: "1px solid #3a3a4a", background: "#1e1e2e", color: "#f0f0f0", fontSize: 16, outline: "none" }} />
            {unit && <span style={{ color: "#888", fontSize: 14, minWidth: 30 }}>{unit}</span>}
          </div>
          {helpText && <span style={{ fontSize: 11, color: "#666", marginTop: 4, display: "block" }}>{helpText}</span>}
        </div>
      );
    }

    function CC({ label, value, icon, color, sub }) {
      return (
        <div style={{ background: "linear-gradient(135deg, #1e1e2e 0%, #2a2a3e 100%)", borderRadius: 14, padding: "14px 16px", border: `1px solid ${color}22`, flex: 1, minWidth: 140 }}>
          <div style={{ fontSize: 20, marginBottom: 4 }}>{icon}</div>
          <div style={{ fontSize: 10, color: "#888", fontWeight: "bold" }}>{label}</div>
          <div style={{ fontSize: 18, fontWeight: 800, color }}>{value}</div>
          {sub && <div style={{ fontSize: 10, color: "#666", marginTop: 3 }}>{sub}</div>}
        </div>
      );
    }

    function App() {
      const [pg, sPg] = useState(50), [th, sTh] = useState(4), [tm, sTm] = useState(30), [mat, sMat] = useState("PLA");
      const [ci, sCi] = useState(3000), [vu, sVu] = useState(5000), [pw, sPw] = useState(250), [ckw, sCkw] = useState(0.85);
      const [inf, sInf] = useState(20), [fp, sFp] = useState(5);
      const [lix, sLix] = useState(false), [pin, sPin] = useState(false), [acab, sAcab] = useState(false), [sup, sSup] = useState(true);
      const [vhm, sVhm] = useState(30), [tsu, sTsu] = useState(15), [tpp, sTpp] = useState(20);
      const [ml, sMl] = useState(50), [qtd, sQtd] = useState(1), [cfm, sCfm] = useState(200), [hm, sHm] = useState(200);
      const [ff, sFf] = useState(15), [fpc, sFpc] = useState(true), [ce, sCe] = useState(3);
      const [rt, sRt] = useState("mei"), [ac, sAc] = useState(6), [mk, sMk] = useState("nenhum"), [tmc, sTmc] = useState(15), [tfm, sTfm] = useState(0);
      const [tab, sTab] = useState("peca"), [arch, sArch] = useState([]), [nome, sNome] = useState(""), [notas, sNotas] = useState(""), [status, sStatus] = useState("verificada");
      const [search, sSearch] = useState(""), [filt, sFilt] = useState("todos"), [sort, sSort] = useState("data"), [cdel, sCdel] = useState(null), [saved, sSaved] = useState(false);

      useEffect(() => { sArch(ldA()); }, []);

      const aImp = useMemo(() => ({ mei:5, simples:6, presumido:11.33, real:15, informal:0, custom:ac }[rt]), [rt, ac]);
      const tMk = useMemo(() => mk === "nenhum" ? 0 : mk === "custom" ? tmc : marketplacePresets[mk].taxa, [mk, tmc]);

      const c = useMemo(() => {
        const m = materialData[mat], tH = th + tm / 60;
        const cMat = (pg / 1000) * m.pricePerKg, cEn = (pw / 1000) * tH * ckw, dep = (ci / vu) * tH;
        const cMdo = ((tsu + tpp) / 60) * vhm;
        let cPos = 0; if (lix) cPos += 2.5; if (pin) cPos += 8; if (acab) cPos += 5; if (sup) cPos += 1.5;
        const cFalha = (cMat + cEn) * (fp / 100), rCF = (cfm / hm) * tH, cEmb = ce, cFr = fpc ? 0 : ff;
        const cProd = cMat + cEn + dep + cMdo + cPos + cFalha + rCF + cEmb + cFr;
        const pBase = cProd * (1 + ml / 100), tTx = (tMk / 100) + (aImp / 100);
        const pFin = tTx < 1 ? pBase / (1 - tTx) : pBase * 2;
        const vImp = pFin * (aImp / 100), vMk = pFin * (tMk / 100) + tfm;
        const cTot = cProd + vImp + vMk;
        return { cMat, cEn, dep, cMdo, cPos, cFalha, rCF, cEmb, cFr, cProd, vImp, vMk, cTot, pVenda: pFin, lucro: pFin - cTot, tH, pesoTot: pg * qtd };
      }, [pg, th, tm, mat, ci, vu, pw, ckw, fp, lix, pin, acab, sup, vhm, tsu, tpp, ml, qtd, cfm, hm, ff, fpc, ce, aImp, tMk, tfm]);

      const f = v => `R$ ${v.toFixed(2)}`;
      
      const doSave = () => {
        if (!nome) return;
        const n = { id: Date.now(), nome, status, data: new Date().toISOString(), params: { mat, pg, th, tm }, res: { cTot: c.cTot, pVenda: c.pVenda, lucro: c.lucro } };
        const u = [n, ...arch]; sArch(u); svA(u); sNome(""); sSaved(true); setTimeout(() => sSaved(false), 2000);
      };

      const fArch = arch.filter(p => (filt === "todos" || p.status === filt) && (p.nome.toLowerCase().includes(search.toLowerCase())));

      return (
        <div style={{ maxWidth: 920, margin: "0 auto", padding: "24px 16px" }}>
          <header style={{ textAlign: "center", marginBottom: 30 }}>
            <h1 style={{ fontSize: 26, fontWeight: 900, background: "linear-gradient(135deg,#7c5cfc,#00d4aa)", WebkitBackgroundClip: "text", WebkitTextFillColor: "transparent" }}>CALCULADORA DE IMPRESS√ÉO 3D</h1>
            <p style={{ color: "#666", fontSize: 12, fontWeight: "bold" }}>SISTEMA DE GEST√ÉO CB¬≤K PRESENTES 3D</p>
          </header>

          <div style={{ display: "flex", gap: 10, flexWrap: "wrap", marginBottom: 24 }}>
            <CC icon="üè≠" label="CUSTO PRODU√á√ÉO" value={f(c.cProd)} color="#ff6b6b" sub="SEM TAXAS" />
            <CC icon="üí∞" label="CUSTO TOTAL" value={f(c.cTot)} color="#ffa94d" sub="COM IMPOSTOS" />
            <CC icon="üè∑Ô∏è" label="PRE√áO VENDA" value={f(c.pVenda)} color="#00d4aa" sub="SUGERIDO" />
            <CC icon="üìà" label="LUCRO L√çQUIDO" value={f(c.lucro)} color="#7c5cfc" sub="POR PE√áA" />
          </div>

          <div style={{ display: "flex", gap: 4, marginBottom: 20, overflowX: "auto", paddingBottom: 5 }}>
            {["PE√áA", "OPERACIONAL", "M√ÉO DE OBRA", "ACABAMENTO", "VENDA", "ARQUIVO"].map(t => (
              <button key={t} onClick={() => sTab(t.toLowerCase().replace(" ", ""))} style={{ padding: "10px 16px", borderRadius: 10, border: "none", fontSize: 11, fontWeight: 800, cursor: "pointer", background: tab === t.toLowerCase().replace(" ", "") ? "#7c5cfc" : "#1e1e2e", color: "#fff", whiteSpace: "nowrap" }}>{t}</button>
            ))}
          </div>

          <div style={{ background: "#1a1a2e", padding: 24, borderRadius: 16, border: "1px solid #2a2a3e" }}>
            {tab === "peca" && (
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 20 }}>
                <NI label="MATERIAL" value={mat} onChange={sMat} unit="" helpText="TIPO DE FILAMENTO" />
                <NI label="PESO DA PE√áA" value={pg} onChange={sPg} unit="G" />
                <NI label="HORAS" value={th} onChange={sTh} unit="H" />
                <NI label="MINUTOS" value={tm} onChange={sTm} unit="MIN" />
              </div>
            )}

            {tab === "operacional" && (
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 20 }}>
                <NI label="CUSTO IMPRESSORA" value={ci} onChange={sCi} unit="R$" />
                <NI label="VIDA √öTIL" value={vu} onChange={sVu} unit="H" />
                <NI label="POT√äNCIA" value={pw} onChange={sPw} unit="W" />
                <NI label="CUSTO KWH" value={ckw} onChange={sCkw} unit="R$" />
              </div>
            )}

            {tab === "maodeobra" && (
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 20 }}>
                <NI label="VALOR DA HORA" value={vhm} onChange={sVhm} unit="R$" />
                <NI label="SETUP" value={tsu} onChange={sTsu} unit="MIN" />
                <NI label="P√ìS-PROCESSAMENTO" value={tpp} onChange={sTpp} unit="MIN" />
              </div>
            )}

            {tab === "acabamento" && (
              <div>
                <h3 style={{ fontSize: 13, marginBottom: 15 }}>SELECIONE OS PROCESSOS:</h3>
                {[["LIXAMENTO", lix, sLix], ["PINTURA", pin, sPin], ["ACABAMENTO ESPECIAL", acab, sAcab], ["SUPORTES", sup, sSup]].map(([n, v, s]) => (
                  <button key={n} onClick={() => s(!v)} style={{ width: "100%", padding: 12, marginBottom: 8, borderRadius: 10, border: "1px solid #3a3a4a", background: v ? "#7c5cfc22" : "transparent", color: v ? "#7c5cfc" : "#fff", fontWeight: "bold", cursor: "pointer", textAlign: "left" }}>
                    {v ? "‚úÖ " : "‚¨ú "} {n}
                  </button>
                ))}
              </div>
            )}

            {tab === "venda" && (
              <div>
                <NI label="MARGEM DE LUCRO (%)" value={ml} onChange={sMl} unit="%" />
                <NI label="EMBALAGEM" value={ce} onChange={sCe} unit="R$" />
                <div style={{ display: "flex", gap: 10, marginTop: 10 }}>
                  <button onClick={() => sRt("mei")} style={{ flex: 1, padding: 10, background: rt === "mei" ? "#7c5cfc" : "#12121e", border: "none", color: "#fff", borderRadius: 8 }}>MEI</button>
                  <button onClick={() => sRt("simples")} style={{ flex: 1, padding: 10, background: rt === "simples" ? "#7c5cfc" : "#12121e", border: "none", color: "#fff", borderRadius: 8 }}>SIMPLES</button>
                </div>
              </div>
            )}

            {tab === "arquivo" && (
              <div>
                <input type="text" placeholder="NOME DA PE√áA" value={nome} onChange={e => sNome(e.target.value)} style={{ width: "100%", padding: 12, background: "#12121e", border: "1px solid #3a3a4a", color: "#fff", borderRadius: 10, marginBottom: 10 }} />
                <button onClick={doSave} style={{ width: "100%", padding: 14, background: "#00d4aa", color: "#12121e", border: "none", fontWeight: 900, borderRadius: 10, cursor: "pointer" }}>{saved ? "SALVO!" : "SALVAR PE√áA"}</button>
                <div style={{ marginTop: 20 }}>
                  {fArch.map(p => (
                    <div key={p.id} style={{ padding: 12, borderBottom: "1px solid #2a2a3e", display: "flex", justifyContent: "space-between" }}>
                      <span>{p.nome.toUpperCase()}</span>
                      <span style={{ color: "#00d4aa", fontWeight: 800 }}>{f(p.res.pVenda)}</span>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>

          <div style={{ marginTop: 24, padding: 20, background: "#1e1e2e", borderRadius: 16 }}>
            <h3 style={{ fontSize: 11, color: "#888", marginBottom: 12 }}>DECOMPOSI√á√ÉO DE CUSTOS (R$)</h3>
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, fontSize: 12 }}>
              <div>MATERIAL: {f(c.cMat)}</div>
              <div>ENERGIA: {f(c.cEn)}</div>
              <div>DEPRECIA√á√ÉO: {f(c.dep)}</div>
              <div>FIXOS: {f(c.rCF)}</div>
              <div style={{ gridColumn: "1/-1", borderTop: "1px solid #3a3a4a", paddingTop: 10, fontWeight: "bold", color: "#7c5cfc" }}>TOTAL PRODU√á√ÉO: {f(c.cProd)}</div>
            </div>
          </div>

          <footer style={{ textAlign: "center", marginTop: 40, fontSize: 10, color: "#444", fontWeight: 800 }}>CB¬≤K PRESENTES 3D | BRAS√çLIA 2026</footer>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
